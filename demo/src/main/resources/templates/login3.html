<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Insert title here</title>
</head>
<body>
	<h3>DW íšŒì›ê°€ì…</h3>
	<input id="userId" type="text" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”..." />
	<button type="button" onclick="doCheck()">ì•„ì´ë”” ì²´í¬</button>
	<input id="userName" type="text" placeholder="ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”..." />
	<input id="userPw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”...." />
	<button type="button" onclick="doJoin()">íšŒì›ê°€ì…</button>

	<h2>DW ë¡œê·¸ì¸</h2>
	<input id="i_userId" type="text" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”..." />
	<input id="i_userName" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”..." />
	<button type="button" onclick="doLogin()">ë¡œê·¸ì¸</button>

</body>
<script src="https://code.jquery.com/jquery-3.6.1.js"
	integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI="
	crossorigin="anonymous"></script>
<script type="text/javascript">

	var isCheck = false;

	//ì•„ì´ë”” ì¤‘ë³µ ì²´í¬ : ì´ë¯¸ ê°€ì…ëœ ì•„ì´ë”” ì°¾ê¸°!
	function doCheck(){
		
		var id = $('#userId').val();
		$.ajax({
			url : '/api/v1/users/'+id,
			type : 'GET',
			dataType : 'json',
			success : function(response) {
				//trueë©´ ì´ë¯¸ ê°€ì…í•œ ì•„ì´ë””ê°€ ì¡´ì¬!
				if(response){
					alert('ì´ë¯¸ ê°€ì…ëœ ì•„ì´ë””ì…ë‹ˆë‹¤!');
					return false;
				}else{
					alert('ì‚¬ìš©ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤!');
					isCheck = true;
					return false;
				}
			}
		});
	}
	
	function doLogin() {
		var id = $('#i_userId').val();
		var pw = $('#i_userName').val();
		var jsonData = {
			"id" : id,
			"pw" : pw
		};
		$.ajax({
			url : '/api/v1/login',
			type : 'POST',
			contentType : 'application/json', //ì„œë²„ì— json íƒ€ì…ìœ¼ë¡œ ë³´ë‚¼ ì˜ˆì •(ìš”ì²­)
			data : JSON.stringify(jsonData),
			dataType : 'json',
			success : function(response) {
				if(response.user){
					//í˜ì´ì§€ ì´ë™ ë¡œì§êµ¬í˜„ ì˜ˆì •
					alert(response.name + ' í™˜ì˜í•©ë‹ˆë‹¤. ğŸ‰ğŸŠğŸ‰ğŸŠ');
					location.href = '/users';
				}else{
					alert('ì•„ì´ë”” í˜¹ì€ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤!');
				}
			}
		});
	}

	function doJoin() {
		//ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì´ìš©í•´ì„¯ ë¹ˆì¹¸ ì²´í¬í•˜ê¸°
		var id = $('#userId').val();
		var name = $('#userName').val();
		var pw = $('#userPw').val();

		if (id === '') {
			alert('ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
			$('#userId').focus();
			return false;
		}
		if (name === '') {
			alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
			$('#userName').focus();
			return false;
		}
		if (pw === '') {
			alert('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
			$('#userPw').focus();
			return false;
		}
		//ajax

		var jsonData = {
			"id" : id,
			"name" : name,
			"pw" : pw
		};

		$.ajax({
			url : '/api/v1/users',
			type : 'POST',
			contentType : 'application/json', //ì„œë²„ì— json íƒ€ì…ìœ¼ë¡œ ë³´ë‚¼ ì˜ˆì •(ìš”ì²­)
			data : JSON.stringify(jsonData),
			dataType : 'json',
			success : function(response) {
				alert('íšŒì›ê°€ì… ì™„ë£Œ ğŸ‰ğŸ‰');
				location.reload(); //ìƒˆë¡œê³ ì¹¨
			}
		});

	}
</script>
</html>